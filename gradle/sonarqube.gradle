/*
 * Copyright (c) 2009 - 2021, DHBW Mannheim - TIGERs Mannheim
 */

def branch = System.getenv("CI_COMMIT_REF_NAME")

sonarqube {
    properties {
        property "sonar.projectKey", "main_Sumatra_AXyeyj5BLG1xSGHUS0Xf"
        property "sonar.projectVersion", versionDetails.lastTag
        property "sonar.host.url", System.getenv("SONARQUBE_URL")
        property "sonar.login", System.getenv("SONARQUBE_AUTH_TOKEN")
        if (System.getenv("CI_MERGE_REQUEST_IID") != null) {
            property "sonar.pullrequest.key", System.getenv("CI_MERGE_REQUEST_IID")
            property "sonar.pullrequest.branch", System.getenv("CI_MERGE_REQUEST_SOURCE_BRANCH_NAME")
            property "sonar.pullrequest.base", System.getenv("CI_MERGE_REQUEST_TARGET_BRANCH_NAME")
        } else {
            property "sonar.branch.name", branch
        }
    }
}
