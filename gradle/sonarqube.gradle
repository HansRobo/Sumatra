/*
 * Copyright (c) 2009 - 2020, DHBW Mannheim - TIGERs Mannheim
 */

def branch = System.getenv("CI_COMMIT_REF_NAME")

sonarqube {
    properties {
        property "sonar.projectKey", "${project.name}:${branch}"
        property "sonar.projectName", "${project.name} ${branch}"
        property "sonar.projectVersion", "2020" // we actually don't care about the version
        property "sonar.host.url", System.getenv("SONAR_URL")
        property "sonar.login", System.getenv("SONAR_AUTH_TOKEN")
        if (branch != "master") {
            // Only on feature branches
            property "sonar.gitlab.project_id", System.getenv("CI_PROJECT_PATH")
            property "sonar.gitlab.commit_sha", System.getenv("CI_COMMIT_SHA")
            property "sonar.gitlab.ref_name", System.getenv("CI_COMMIT_REF_NAME")
            property "sonar.gitlab.ci_merge_request_iid", System.getenv("CI_MERGE_REQUEST_IID")
        }
    }
}
